/*! ng-catwalk by Adam Timberlake <adam.timberlake@gmail.com> created on 2014-06-29 */
!function(a){"use strict";var b=a.module("ngCatwalk",["ngCrossfilter"]),c={any:function(a){return function(b){return null===b?null:"undefined"!=typeof b?b:a}},number:function(a){return function(b){return null===b?null:"undefined"!=typeof b?+b:a}},string:function(a){return function(b){return null===b?a||null:"undefined"!=typeof b?String(b):a}}},d={};b.service("catwalk",["$rootScope","$q","$interpolate","Crossfilter",function(a,b,e,f){function g(){}return g.prototype={attribute:c,relationship:d,_primaryName:"__catwalkId__",_silent:!1,_eventName:"catwalk/{{type}}/{{collection}}",_collections:{},collection:function(a,b){if(this._collections[a]||(this._collections[a]=new f([])),b){b[this._primaryName]=this.attribute.number(),this._collections[a].primaryKey(this._primaryName),this._collections[a].blueprint=b,this._collections[a].index=0;for(var c in b)b.hasOwnProperty(c)&&this._collections[a].addDimension(c)}return this._collections[a]},silently:function(a){this._silent=!0,a.apply(this),this._silent=!1},createModel:function(a,b){b=this.cleanModel(a,b),this.collection(a).addModel(b);var c=this.createPromise(a,"create",[b]);return c.catch(function(){this.revertCreateModel(a,b)}.bind(this)),b},revertCreateModel:function(a,b){this.collection(a).deleteModel(b)},updateModel:function(){},revertUpdateModel:function(){},deleteModel:function(){},revertDeleteModel:function(){},createPromise:function(c,d,f){var g=b.defer();Array.isArray(f)||(f=f?[f]:[]),f.unshift(g);var h=e(this._eventName)({type:d,collection:c});return a.$broadcast(h,f[0],f[1],f[2]),g.promise},createHasManyRelationship:function(){},createHasOneRelationship:function(){},cleanModel:function(a,b){var c=this.collection(a).blueprint,d=this._propertyIterator,e=this._primaryName;return b[e]=++this.collection(a).index,function(){d(b,function(a){c.hasOwnProperty(a)||delete b[a]})}(),function(){d(c,function(a){var d=c[a];"undefined"==typeof b[a]&&a!==e&&(b[a]=null),b[a]=d(b[a])})}(),b},_propertyIterator:function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c)}},new g}])}(window.angular);